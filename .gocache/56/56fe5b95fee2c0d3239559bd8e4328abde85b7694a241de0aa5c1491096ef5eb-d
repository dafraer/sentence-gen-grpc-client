// Code generated by cmd/cgo; DO NOT EDIT.

//line /Users/kamil/go/pkg/mod/fyne.io/fyne/v2@v2.7.2/app/app_darwin.go:1:1
//go:build !ci && !wasm && !test_web_driver && !mobile && !tinygo

package app

/*
#cgo CFLAGS: -x objective-c
#cgo LDFLAGS: -framework Foundation

#include <stdbool.h>
#include <stdlib.h>

bool isBundled();
void sendNotification(char *title, char *content);
*/
import _ "unsafe"

import (
	"fmt"
	"os/exec"
	"strings"
	"unsafe"

	"fyne.io/fyne/v2"
)

func (a *fyneApp) SendNotification(n *fyne.Notification) {
	if ( /*line :27:5*/_Cfunc_isBundled /*line :27:15*/)() {
		titleStr := ( /*line :28:15*/_Cfunc_CString /*line :28:23*/)(n.Title)
		defer func() func() { _cgo0 := /*line :29:16*/unsafe.Pointer(titleStr); return func() { _cgoCheckPointer(_cgo0, nil); /*line :29:41*/_Cfunc_free(_cgo0); }}()()
		contentStr := ( /*line :30:17*/_Cfunc_CString /*line :30:25*/)(n.Content)
		defer func() func() { _cgo0 := /*line :31:16*/unsafe.Pointer(contentStr); return func() { _cgoCheckPointer(_cgo0, nil); /*line :31:43*/_Cfunc_free(_cgo0); }}()()

		( /*line :33:3*/_Cfunc_sendNotification /*line :33:20*/)(titleStr, contentStr)
		return
	}

	fallbackNotification(n.Title, n.Content)
}

func escapeNotificationString(in string) string {
	noSlash := strings.ReplaceAll(in, "\\", "\\\\")
	return strings.ReplaceAll(noSlash, "\"", "\\\"")
}

//export fallbackSend
func fallbackSend(cTitle, cContent * /*line :46:37*/_Ctype_char /*line :46:43*/) {
	title := ( /*line :47:11*/_Cfunc_GoString /*line :47:20*/)(cTitle)
	content := ( /*line :48:13*/_Cfunc_GoString /*line :48:22*/)(cContent)
	fallbackNotification(title, content)
}

func fallbackNotification(title, content string) {
	template := `display notification "%s" with title "%s"`
	script := fmt.Sprintf(template, escapeNotificationString(content), escapeNotificationString(title))

	err := exec.Command("osascript", "-e", script).Start()
	if err != nil {
		fyne.LogError("Failed to launch darwin notify script", err)
	}
}
